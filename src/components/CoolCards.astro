---
const arrayCards = [
  {
    title: 'LedMansion Landing',
    repo: 'https://github.com/20essentials/project-000-214',
    web: 'https://20essentials.github.io/project-000-214/',
    localImage: '/assets/a214.avif',
    id: 1,
  },
  {
    title: 'Custom Fancy Landing',
    repo: 'https://github.com/20essentials/project-000-277',
    web: 'https://20essentials.github.io/project-000-277/',
    localImage: '/assets/a277.avif',
    id: 2,
  },
  {
    title: 'Slider Vertical',
    repo: 'https://github.com/20essentials/project-000-860',
    web: 'https://20essentials.github.io/project-000-860/',
    localImage: '/assets/a860.avif',
    id: 3,
  },
  {
    title: 'Searcher Films',
    repo: 'https://github.com/20essentials/project-000-392',
    web: 'https://20essentials.github.io/project-000-392/',
    localImage: '/assets/a392.avif',
    id: 4,
  },
  {
    title: 'Cart Shopping',
    repo: 'https://github.com/20essentials/project-000-452',
    web: 'https://20essentials.github.io/project-000-452/',
    localImage: '/assets/a452.avif',
    id: 5,
  },
  {
    title: 'Filter Price',
    repo: 'https://github.com/20essentials/project-000-499',
    web: 'https://20essentials.github.io/project-000-499/',
    localImage: '/assets/a499.avif',
    id: 6,
  },
  {
    title: 'Tic Tac Toe',
    repo: 'https://github.com/20essentials/project-000-104',
    web: 'https://20essentials.github.io/project-000-104/',
    localImage: '/assets/a104.avif',
    id: 7,
  },
  {
    title: 'MouseFollower',
    repo: 'https://github.com/20essentials/project-000-108',
    web: 'https://20essentials.github.io/project-000-108/',
    localImage: '/assets/a108.avif',
    id: 8,
  },
  {
    title: 'Conecta4',
    repo: 'https://github.com/20essentials/project-000-109',
    web: 'https://20essentials.github.io/project-000-109/',
    localImage: '/assets/a109.avif',
    id: 9,
  },
  {
    title: 'Medidor',
    repo: 'https://github.com/20essentials/project-000-103',
    web: 'https://20essentials.github.io/project-000-103/',
    localImage: '/assets/a103.avif',
    id: 10,
  },
  {
    title: 'Giphy Api Used',
    repo: 'https://github.com/20essentials/project-000-115',
    web: 'https://20essentials.github.io/project-000-115/',
    localImage: '/assets/a115.avif',
    id: 11,
  },
  {
    title: 'Sudoku',
    repo: 'https://github.com/20essentials/project-000-121',
    web: 'https://20essentials.github.io/project-000-121/',
    localImage: '/assets/a121.avif',
    id: 12,
  },
  {
    title: 'Lander Display',
    repo: 'https://github.com/20essentials/project-000-129',
    web: 'https://20essentials.github.io/project-000-129/',
    localImage: '/assets/a129.avif',
    id: 13,
  },
  {
    title: 'Speech Recognition',
    repo: 'https://github.com/20essentials/project-000-979',
    web: 'https://20essentials.github.io/project-000-979/',
    localImage: '/assets/a979.avif',
    id: 14,
  },
  {
    title: 'Spell Words',
    repo: 'https://github.com/20essentials/project-000-980',
    web: 'https://20essentials.github.io/project-000-980/',
    localImage: '/assets/a980.avif',
    id: 15,
  },
  {
    title: 'Scrollin',
    repo: 'https://github.com/20essentials/project-000-981',
    web: 'https://20essentials.github.io/project-000-981/',
    localImage: '/assets/a981.avif',
    id: 16,
  },
  {
    title: 'Topea al Topo',
    repo: 'https://github.com/20essentials/project-000-983',
    web: 'https://20essentials.github.io/project-000-983/',
    localImage: '/assets/a983.avif',
    id: 17,
  },
  {
    title: 'Wheel',
    repo: 'https://github.com/20essentials/project-000-985',
    web: 'https://20essentials.github.io/project-000-985/',
    localImage: '/assets/a985.avif',
    id: 18,
  },
  {
    title: 'MonkeyIsland Classic',
    repo: 'https://github.com/20essentials/project-000-986',
    web: 'https://20essentials.github.io/project-000-986/',
    localImage: '/assets/a986.avif',
    id: 19,
  },
  {
    title: 'El Juego de la Vida',
    repo: 'https://github.com/20essentials/project-000-987',
    web: 'https://20essentials.github.io/project-000-987/',
    localImage: '/assets/a987.avif',
    id: 20,
  }
];

---

<section class='cards'>
  {
    arrayCards.map(({ title, web, repo, localImage }) => {
      return (
        <a href={repo} class='three-d-wrapper' style={`--bg: url(${localImage})`}>
          <div class={`card charizard animated`} />
        </a>
      );
    })
  }
</section>

<style>
  :root {
    --color1: rgb(0, 231, 255);
    --color2: rgb(255, 0, 231);
    --charizard1: #fac;
    --charizard2: #ddccaa;
    --pika1: #54a29e;
    --pika2: #a79d66;
    --eevee1: #ec9bb6;
    --eevee2: #ccac6f;
    --eevee3: #69e4a5;
    --eevee4: #8ec5d6;
    --eevee5: #b98cce;
    --mewtwo1: #efb2fb;
    --mewtwo2: #acc6f8;
  }

  .cards {
    min-height: 100vh;
    background-color: #000;
    width: 100%;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(17vmax, 1fr));
    place-content: start;
    --pad: 2vmax;
    gap: var(--pad);
    padding: var(--pad);
    place-content: center;

    @media (width <= 1111px) {
      --pad: 4.3vmax;
      grid-template-columns: repeat(auto-fit, minmax(16vmax, 1fr));
    }

    .three-d-wrapper {
      perspective: 50vmax;
      isolation: isolate;
      transform: translate3d(0.1px, 0.1px, 0.1px);
    }

    .card {
      min-width: 16vw;
      width: 100%;
      aspect-ratio: 12 / 17;
      position: relative;
      overflow: hidden;
      z-index: 10;
      touch-action: none;
      isolation: isolate;
      border-radius: 5% / 3.5%;
      box-shadow:
        -0.25vmax -0.25vmax 0.25vmax -0.25vmax var(--color1),
        0.25vmax 0.25vmax 0.25vmax -0.25vmax var(--color2),
        0 0 0.25vmax 0 rgba(255, 255, 255, 0),
        0 2.75vmax 1.75vmax -1vmax rgba(0, 0, 0, 0.5);

      transition:
        transform 0.5s ease,
        box-shadow 0.2s ease;
      will-change: transform, filter;
      background-color: #040712;
      background-image: var(--bg);
      background-size: cover;
      background-repeat: no-repeat;
      background-position: 50% 50%;
      transform-origin: center;

      &:before,
      &:after {
        content: '';
        position: absolute;
        inset: 0;
        opacity: 0.5;
        mix-blend-mode: color-dodge;
        transition: all 0.33s ease;
        
      }

      &:before {
        background-image: linear-gradient(
          115deg,
          transparent 0%,
          var(--color1) 25%,
          transparent 47%,
          transparent 53%,
          var(--color2) 75%,
          transparent 100%
        );
        background-size: 300% 300%;
        filter: brightness(0.5) contrast(1);
        z-index: 1;
      }

      &:after {
        background-image: url('https://assets.codepen.io/13471/sparkles.gif'),
          url(https://assets.codepen.io/13471/holo.png),
          linear-gradient(
            125deg,
            #ff008450 15%,
            #fca40040 30%,
            #ffff0030 40%,
            #00ff8a20 60%,
            #00cfff40 70%,
            #cc4cfa50 85%
          );
        background-position: 50% 50%;
        background-size: 160%;
        background-blend-mode: overlay;
        filter: brightness(1) contrast(1);
        z-index: 2;
        opacity: 0.5;
      }

      &:hover,
      &.active {
        animation: none;
        transition: box-shadow 0.1s ease-out;

        &:before {
          background-image: linear-gradient(
            110deg,
            transparent 25%,
            var(--color1) 48%,
            var(--color2) 52%,
            transparent 75%
          );
          background-size: 250% 250%;
          filter: brightness(0.66) contrast(1.33);
          opacity: 0.88;
          transition: none;
        }

        &:after {
          filter: brightness(1) contrast(1);
          opacity: 1;
          transition: none;
        }
      }

      &.animated {
        animation: holoCard 12s ease 0s 1;
        &:before {
          animation: holoGradient 12s ease 0s 1;
        }
        &:after {
          animation: holoSparkle 12s ease 0s 1;
        }
      }

      &:hover {
        box-shadow:
          0 0 1.5vmax -0.25vmax white,
          0 0 0.5vmax -0.1vmax white,
          0 2.75vmax 1.75vmax -1vmax rgba(0, 0, 0, 0.5);

        &:before {
          background-image: linear-gradient(
            115deg,
            transparent 20%,
            var(--color1) 36%,
            var(--color2) 43%,
            var(--color3) 50%,
            var(--color4) 57%,
            var(--color5) 64%,
            transparent 80%
          );
        }
      }

      &.charizard {
        --color1: var(--charizard1);
        --color2: var(--charizard2);
      }

      &.pika {
        --color1: var(--pika1);
        --color2: var(--pika2);
      }

      &.mewtwo {
        --color1: var(--mewtwo1);
        --color2: var(--mewtwo2);
      }

      &.eevee {
        --color1: var(--eevee1);
        --color2: var(--eevee2);
        --color3: var(--eevee3);
        --color4: var(--eevee4);
        --color5: var(--eevee5);
      }
    }
  }

  @keyframes holoSparkle {
    0%,
    100% {
      opacity: 0.75;
      background-position: 50% 50%;
      filter: brightness(1.2) contrast(1.25);
    }
    5%,
    8% {
      opacity: 1;
      background-position: 40% 40%;
      filter: brightness(0.8) contrast(1.2);
    }
    13%,
    16% {
      opacity: 0.5;
      background-position: 50% 50%;
      filter: brightness(1.2) contrast(0.8);
    }
    35%,
    38% {
      opacity: 1;
      background-position: 60% 60%;
      filter: brightness(1) contrast(1);
    }
    55% {
      opacity: 0.33;
      background-position: 45% 45%;
      filter: brightness(1.2) contrast(1.25);
    }
  }

  @keyframes holoGradient {
    0%,
    100% {
      opacity: 0.5;
      background-position: 50% 50%;
      filter: brightness(0.5) contrast(1);
    }
    5%,
    9% {
      background-position: 100% 100%;
      opacity: 1;
      filter: brightness(0.75) contrast(1.25);
    }
    13%,
    17% {
      background-position: 0% 0%;
      opacity: 0.88;
    }
    35%,
    39% {
      background-position: 100% 100%;
      opacity: 1;
      filter: brightness(0.5) contrast(1);
    }
    55% {
      background-position: 0% 0%;
      opacity: 1;
      filter: brightness(0.75) contrast(1.25);
    }
  }

  @keyframes holoCard {
    0%,
    100% {
      transform: rotateZ(0deg) rotateX(0deg);
    }
    50% {
      transform: rotateZ(1deg) rotateX(1deg);
    }
  }
</style>

<script type='module'>
  const cards = document.querySelectorAll('.card');

  let timeoutId;

  cards.forEach(card => {
    const handleMove = e => {
      e.preventDefault();

      const isTouch = e.type === 'touchmove';
      const rect = card.getBoundingClientRect();

      const offsetX = isTouch ? e.touches[0].clientX - rect.left : e.offsetX;
      const offsetY = isTouch ? e.touches[0].clientY - rect.top : e.offsetY;

      const w = card.offsetWidth;
      const h = card.offsetHeight;

      const px = Math.abs(Math.floor((100 / w) * offsetX) - 100);
      const py = Math.abs(Math.floor((100 / h) * offsetY) - 100);
      const pa = 50 - px + (50 - py);

      const lp = 50 + (px - 50) / 1.5;
      const tp = 50 + (py - 50) / 1.5;
      const pxSpark = 50 + (px - 50) / 7;
      const pySpark = 50 + (py - 50) / 7;
      const opacity = 20 + Math.abs(pa) * 1.5;

      const ty = ((tp - 50) / 2) * -1;
      const tx = ((lp - 50) / 1.5) * 0.5;

      card.classList.remove('animated');
      card.style.transform = `rotateX(${ty}deg) rotateY(${tx}deg)`;
      clearTimeout(timeoutId);
    };

    const handleLeave = () => {
      card.removeAttribute('style');

      timeoutId = setTimeout(() => {
        card.classList.add('animated');
      }, 2500);
    };

    card.addEventListener('mousemove', handleMove);
    card.addEventListener('touchmove', handleMove, { passive: false });

    card.addEventListener('mouseout', handleLeave);
    card.addEventListener('touchend', handleLeave);
    card.addEventListener('touchcancel', handleLeave);
  });
</script>
